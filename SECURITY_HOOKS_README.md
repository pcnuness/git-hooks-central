# Hooks de Seguran√ßa Pre-Push

Este reposit√≥rio cont√©m hooks de seguran√ßa robustos para projetos Java e Node.js, implementados usando o framework pre-commit.

## üöÄ Funcionalidades

### ‚úÖ Verifica√ß√µes de Seguran√ßa Implementadas

1. **SAST (Static Application Security Testing)**
   - Semgrep com padr√µes OWASP Top 10
   - SpotBugs para Java
   - ESLint com regras de seguran√ßa para Node.js

2. **Branch Ahead Check**
   - Verifica se a branch est√° atualizada com a master/main
   - Previne push de branches desatualizadas

3. **Dependency Scanning**
   - OWASP Dependency-Check para Java
   - npm/yarn/pnpm audit para Node.js
   - Gradle dependency check plugin

4. **Secret Detection**
   - GitLeaks para detec√ß√£o de secrets
   - TruffleHog para an√°lise de c√≥digo
   - Padr√µes customizados para Java e Node.js

## üõ†Ô∏è Compatibilidade

### Java
- **Vers√µes suportadas**: Java 8+
- **Build tools**: Maven 3.6+, Gradle 7.0+
- **Ferramentas**: Semgrep, SpotBugs, OWASP Dependency-Check

### Node.js
- **Vers√µes suportadas**: Node 16+
- **Package managers**: npm 8+, yarn 1.22+, pnpm 7.0+
- **Ferramentas**: Semgrep, ESLint, npm audit

## üìã Pr√©-requisitos

### Sistema
- Git
- Bash (Linux/macOS) ou Git Bash (Windows)
- Python 3.7+ (para pre-commit)

### Ferramentas de Seguran√ßa
```bash
# Instala√ß√£o autom√°tica via script
bash hooks/install-security-hooks.sh

# Ou instala√ß√£o manual
pip install pre-commit semgrep trufflehog
brew install gitleaks dependency-check  # macOS
```

## üöÄ Instala√ß√£o R√°pida

### 1. Clone o reposit√≥rio
```bash
git clone https://github.com/seu-usuario/git-hooks-central.git
cd git-hooks-central
```

### 2. Execute o instalador
```bash
bash hooks/install-security-hooks.sh
```

### 3. Configure o projeto
```bash
# Para projetos Java
cp hooks/java-security-config.yaml ./
# Edite as configura√ß√µes conforme necess√°rio

# Para projetos Node.js
cp hooks/node-security-config.yaml ./
# Edite as configura√ß√µes conforme necess√°rio
```

## üìÅ Estrutura dos Arquivos

```
hooks/
‚îú‚îÄ‚îÄ security_pre_push.sh          # Hook principal de seguran√ßa
‚îú‚îÄ‚îÄ install-security-hooks.sh     # Script de instala√ß√£o
‚îú‚îÄ‚îÄ java-security-config.yaml     # Configura√ß√£o para Java
‚îú‚îÄ‚îÄ node-security-config.yaml     # Configura√ß√£o para Node.js
‚îú‚îÄ‚îÄ sast_semantic_fast.sh        # Hook SAST r√°pido (legado)
‚îú‚îÄ‚îÄ deps_audit_fast.sh           # Hook de auditoria (legado)
‚îî‚îÄ‚îÄ branch_ahead_check.sh        # Hook de verifica√ß√£o (legado)
```

## ‚öôÔ∏è Configura√ß√£o

### Configura√ß√£o B√°sica

O hook √© configurado automaticamente via `.pre-commit-config.yaml`:

```yaml
- repo: local
  hooks:
    - id: security-pre-push-hook
      name: Security Pre-Push Hook
      entry: bash hooks/security_pre_push.sh
      language: system
      stages: [pre-push]
      always_run: true
```

### Configura√ß√µes Espec√≠ficas

#### Java
```yaml
# hooks/java-security-config.yaml
sast:
  semgrep:
    config: "p/owasp-top-ten"
    timeout: 60

dependency_scanning:
  owasp_dependency_check:
    fail_on_cvss: 7.0
```

#### Node.js
```yaml
# hooks/node-security-config.yaml
dependency_scanning:
  npm_audit:
    audit_level: "high"
    production_only: false
```

## üîß Uso

### Execu√ß√£o Autom√°tica
Os hooks rodam automaticamente antes de cada `git push`:

```bash
git add .
git commit -m "feat: nova funcionalidade"
git push  # Hooks executam automaticamente
```

### Execu√ß√£o Manual
```bash
# Executar todos os hooks
pre-commit run --all-files --hook-stage pre-push

# Executar apenas o hook de seguran√ßa
bash hooks/security_pre_push.sh

# Executar hooks espec√≠ficos
pre-commit run sast-semantic-fast --all-files
```

## üìä Logs e Relat√≥rios

### Arquivo de Log
- **Localiza√ß√£o**: `.security-hook.log`
- **Formato**: Timestamp + Level + Mensagem
- **Rota√ß√£o**: Autom√°tica (10MB, 5 backups)

### Exemplo de Log
```
[2024-01-15 10:30:15] [INFO] === INICIANDO VERIFICA√á√ïES DE SEGURAN√áA PRE-PUSH ===
[2024-01-15 10:30:15] [INFO] Tipo de projeto detectado: java
[2024-01-15 10:30:16] [SUCCESS] Semgrep SAST conclu√≠do sem problemas cr√≠ticos
[2024-01-15 10:30:17] [SUCCESS] OWASP Dependency-Check conclu√≠do
[2024-01-15 10:30:18] [SUCCESS] GitLeaks n√£o encontrou secrets expostos
```

## üö® Tratamento de Erros

### Estrat√©gias de Fallback
1. **Continue on Failure**: Se uma ferramenta falhar, outras continuam
2. **Offline Mode**: Cache local quando servi√ßos est√£o indispon√≠veis
3. **Timeout Protection**: Limite de 5 minutos por verifica√ß√£o
4. **Graceful Degradation**: Warnings em vez de falhas para ferramentas opcionais

### C√≥digos de Sa√≠da
- `0`: Todas as verifica√ß√µes passaram
- `1`: Algumas verifica√ß√µes falharam (push bloqueado)
- `2`: Erro cr√≠tico no hook

## ‚ö° Performance e Otimiza√ß√µes

### Estrat√©gias de Performance
1. **Cache Inteligente**: Resultados s√£o cacheados por 24h
2. **Execu√ß√£o Paralela**: M√∫ltiplas ferramentas rodam simultaneamente
3. **Timeout Configur√°vel**: Evita travamentos
4. **Sele√ß√£o de Arquivos**: Apenas arquivos modificados s√£o analisados

### M√©tricas de Performance
- **Tempo m√©dio**: 30-90 segundos
- **Uso de mem√≥ria**: 1-2GB
- **Overhead no push**: <2 minutos

### Otimiza√ß√µes Recomendadas
```bash
# Configurar cache
export SEMGREP_CACHE_DIR="$HOME/.cache/semgrep"
export GITLEAKS_CACHE_DIR="$HOME/.cache/gitleaks"

# Usar modo r√°pido para desenvolvimento
export SECURITY_HOOK_FAST_MODE=true
```

## üîí Seguran√ßa e Conformidade

### Padr√µes Implementados
- **OWASP Top 10**: Padr√µes de seguran√ßa web
- **CWE**: Common Weakness Enumeration
- **CVSS**: Common Vulnerability Scoring System
- **NIST**: National Institute of Standards and Technology

### N√≠veis de Severidade
- **Critical (9.0-10.0)**: Bloqueia push
- **High (7.0-8.9)**: Bloqueia push
- **Medium (4.0-6.9)**: Warning
- **Low (0.1-3.9)**: Info

## üß™ Testes e Valida√ß√£o

### Como Testar
```bash
# 1. Teste b√°sico
bash hooks/security_pre_push.sh

# 2. Teste com pre-commit
pre-commit run --all-files --hook-stage pre-push

# 3. Teste de push
git commit -m "test" --allow-empty
git push

# 4. Verificar logs
tail -f .security-hook.log
```

### Cen√°rios de Teste
1. **Projeto Java limpo**: Todas as verifica√ß√µes passam
2. **Projeto Node.js com vulnerabilidades**: Push bloqueado
3. **Branch desatualizada**: Push bloqueado
4. **Secrets expostos**: Push bloqueado
5. **Ferramentas indispon√≠veis**: Modo fallback ativado

## üöÄ Exemplos de Uso

### Projeto Java (Spring Boot)
```bash
# 1. Configurar projeto
cp hooks/java-security-config.yaml ./
# Editar configura√ß√µes espec√≠ficas

# 2. Instalar hooks
bash hooks/install-security-hooks.sh

# 3. Desenvolver e commitar
git add .
git commit -m "feat: nova API endpoint"
git push  # Hooks executam automaticamente
```

### Projeto Node.js (Express)
```bash
# 1. Configurar projeto
cp hooks/node-security-config.yaml ./
# Editar configura√ß√µes espec√≠ficas

# 2. Instalar hooks
bash hooks/install-security-hooks.sh

# 3. Desenvolver e commitar
git add .
git commit -m "feat: middleware de autentica√ß√£o"
git push  # Hooks executam automaticamente
```

## üîß Personaliza√ß√£o

### Vari√°veis de Ambiente
```bash
# Configura√ß√µes gerais
export DEFAULT_BRANCH="main"
export SECURITY_HOOK_TIMEOUT=300
export SECURITY_HOOK_LOG_LEVEL="INFO"

# Configura√ß√µes espec√≠ficas
export SEMGREP_CONFIG="p/owasp-top-ten"
export GITLEAKS_ENABLE=true
export DEPENDENCY_CHECK_ENABLE=true
```

### Configura√ß√µes Customizadas
```yaml
# hooks/custom-security-config.yaml
sast:
  custom_rules:
    - pattern: "custom_security_pattern"
      message: "Custom security issue detected"
      severity: "high"

dependency_scanning:
  custom_scanners:
    - name: "custom_scanner"
      command: "custom-scan-tool"
      args: ["--scan", "."]
```

## üêõ Troubleshooting

### Problemas Comuns

#### 1. Hook n√£o executa
```bash
# Verificar instala√ß√£o
pre-commit --version
pre-commit install --hook-type pre-push

# Verificar permiss√µes
chmod +x hooks/security_pre_push.sh
```

#### 2. Ferramentas n√£o encontradas
```bash
# Instalar ferramentas
bash hooks/install-security-hooks.sh

# Verificar PATH
which semgrep
which gitleaks
```

#### 3. Timeout nas verifica√ß√µes
```bash
# Aumentar timeout
export SECURITY_HOOK_TIMEOUT=600

# Usar modo r√°pido
export SECURITY_HOOK_FAST_MODE=true
```

#### 4. Falsos positivos
```bash
# Configurar exclus√µes
# hooks/java-security-config.yaml
secret_detection:
  ignore_files:
    - "**/test-data/**"
    - "**/fixtures/**"
```

### Logs de Debug
```bash
# Habilitar debug
export SECURITY_HOOK_DEBUG=true

# Ver logs detalhados
tail -f .security-hook.log

# Ver logs do pre-commit
pre-commit run --all-files --hook-stage pre-push --verbose
```

## üìö Recursos Adicionais

### Documenta√ß√£o
- [pre-commit](https://pre-commit.com/)
- [Semgrep](https://semgrep.dev/docs/)
- [OWASP Dependency-Check](https://owasp.org/www-project-dependency-check/)
- [GitLeaks](https://github.com/zricethezav/gitleaks)

### Ferramentas Relacionadas
- [SonarQube](https://www.sonarqube.org/)
- [Snyk](https://snyk.io/)
- [CodeQL](https://codeql.github.com/)
- [Bandit](https://bandit.readthedocs.io/)

### Comunidade
- [OWASP](https://owasp.org/)
- [Security Headers](https://securityheaders.com/)
- [HackerOne](https://hackerone.com/)

## ü§ù Contribui√ß√£o

### Como Contribuir
1. Fork o reposit√≥rio
2. Crie uma branch para sua feature
3. Implemente as mudan√ßas
4. Teste localmente
5. Submeta um Pull Request

### Padr√µes de C√≥digo
- Bash: [ShellCheck](https://www.shellcheck.net/)
- YAML: [yamllint](https://yamllint.readthedocs.io/)
- Documenta√ß√£o: Markdown

### Testes
```bash
# Executar testes
bash hooks/security_pre_push.sh --test

# Validar configura√ß√µes
yamllint hooks/*.yaml
shellcheck hooks/*.sh
```

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para detalhes.

## üÜò Suporte

### Canais de Suporte
- **Issues**: [GitHub Issues](https://github.com/seu-usuario/git-hooks-central/issues)
- **Documenta√ß√£o**: Este README
- **Logs**: `.security-hook.log`

### Informa√ß√µes de Contato
- **Email**: suporte@exemplo.com
- **Slack**: #security-hooks
- **Teams**: Security Hooks Channel

---

**‚ö†Ô∏è Importante**: Este hook √© uma camada adicional de seguran√ßa. N√£o substitui outras pr√°ticas de seguran√ßa como code review, testes automatizados e monitoramento cont√≠nuo.
